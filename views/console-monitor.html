<!DOCTYPE html>
<html>
<head>
    <title>Admin Console Test</title>
    <style>
        body { 
            font-family: 'Courier New', monospace;
            margin: 0; 
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        #console {
            background: #252526;
            border: 1px solid #404040;
            padding: 10px;
            height: 400px;
            overflow-y: auto;
            font-size: 12px;
            line-height: 1.4;
            margin-bottom: 20px;
        }
        .log { color: #d4d4d4; }
        .warn { color: #ff9800; }
        .error { color: #f44747; }
        .info { color: #4ec9b0; }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #0e639c;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 3px;
        }
        button:hover { background: #1177bb; }
    </style>
</head>
<body>
    <h1>Admin Console Monitor</h1>
    <p>This page opens the admin page in a hidden iframe and captures console messages.</p>
    
    <div>
        <button onclick="loadAdminPage()">Load Admin Page</button>
        <button onclick="clearConsole()">Clear Console</button>
        <button onclick="testAPI()">Test API</button>
    </div>
    
    <div id="console"></div>
    
    <iframe id="admin-frame" style="display: none;"></iframe>

    <script>
        const consoleEl = document.getElementById('console');
        const messages = [];

        function log(message, type = 'log') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = `[${timestamp}] ${message}`;
            messages.push({ message: entry, type });
            
            const div = document.createElement('div');
            div.className = type;
            div.textContent = entry;
            consoleEl.appendChild(div);
            consoleEl.scrollTop = consoleEl.scrollHeight;
        }

        function clearConsole() {
            consoleEl.innerHTML = '';
            messages.length = 0;
        }

        function loadAdminPage() {
            log('Loading admin page...', 'info');
            const iframe = document.getElementById('admin-frame');
            
            // Intercept console in iframe
            iframe.onload = function() {
                log('Admin page loaded!', 'info');
                
                // Try to access iframe's console
                try {
                    const iframeWin = iframe.contentWindow;
                    const originalLog = iframeWin.console.log;
                    const originalWarn = iframeWin.console.warn;
                    const originalError = iframeWin.console.error;
                    
                    iframeWin.console.log = (...args) => {
                        log(args.join(' '), 'log');
                        originalLog.apply(iframeWin.console, args);
                    };
                    
                    iframeWin.console.warn = (...args) => {
                        log(args.join(' '), 'warn');
                        originalWarn.apply(iframeWin.console, args);
                    };
                    
                    iframeWin.console.error = (...args) => {
                        log(args.join(' '), 'error');
                        originalError.apply(iframeWin.console, args);
                    };
                    
                    log('Console interception enabled', 'info');
                } catch (e) {
                    log('Could not intercept console: ' + e.message, 'warn');
                }
            };
            
            iframe.src = 'http://localhost:3000/';
        }

        function testAPI() {
            log('Testing API endpoints...', 'info');
            
            Promise.all([
                fetch('/api/assets').then(r => r.json()),
                fetch('/api/bookings').then(r => r.json()),
                fetch('/api/requests').then(r => r.json()),
            ]).then(([assets, bookings, requests]) => {
                log(`✓ Assets: ${Object.keys(assets).length} types`, 'info');
                log(`  - Gedung: ${assets.gedung?.length || 0}`, 'log');
                log(`  - Kendaraan: ${assets.kendaraan?.length || 0}`, 'log');
                log(`  - Barang: ${assets.barang?.length || 0}`, 'log');
                log(`✓ Bookings: ${bookings.length} total`, 'info');
                log(`✓ Requests: ${requests.length} total`, 'info');
            }).catch(err => {
                log('API test failed: ' + err.message, 'error');
            });
        }

        // Auto-load when page loads
        setTimeout(() => {
            log('Page ready. Click "Load Admin Page" to start monitoring.', 'info');
        }, 100);
    </script>
</body>
</html>
